# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Hexo static site generator blog with custom deployment infrastructure. The blog generates static HTML from Markdown source files and deploys to GitHub Pages at https://youngreviews.cc.

## Branch Strategy

**Critical**: This repository uses a two-branch workflow:

- `source` branch: Contains source code, posts, and theme files (THIS IS WHERE YOU WORK)
- `main` branch: Generated static site (auto-generated by GitHub Actions - DO NOT EDIT)

**Never manually modify or force-push to the `main` branch.** Always work on the `source` branch and push there to trigger deployment.

## Common Commands

```bash
# Development: Start local server at http://localhost:4000
npm run server

# Build: Generate static files (creates/updates public/ directory)
npm run build

# Clean: Remove cache and generated files
npm run clean

# Create new post
npx hexo new post "post-title"

# Create draft (not published until moved to _posts)
npx hexo new draft "draft-title"
```

## Deployment

Deployment is fully automated via GitHub Actions (`.github/workflows/deploy.yml`):

1. Push changes to the `source` branch
2. Actions workflow automatically triggers
3. Static files are generated in `public/`
4. Generated files are force-pushed to `main` branch with custom domain `youngreviews.cc`
5. Site is available at https://youngreviews.cc within a few minutes

**Local deployment command exists but should not be used** - let the Actions workflow handle it.

## Project Structure

```
hexo-blog/
├── _config.yml              # Main Hexo configuration
├── source/                  # All content source files
│   ├── _posts/             # Blog posts (Markdown with YAML frontmatter)
│   ├── about/              # About page
│   ├── memos/              # Memos page (interactive memo board)
│   └── images/             # Static images
├── themes/yang-design/      # Custom theme (EJS templates)
│   ├── _config.yml         # Theme configuration (menus, social links, profile)
│   ├── layout/             # EJS templates (index.ejs, post.ejs, memos.ejs, etc.)
│   └── source/             # Theme assets (CSS, JS)
├── public/                  # Generated static site (auto-created, .gitignored in source)
└── scaffolds/               # Templates for new content (post.md, draft.md, page.md)
```

## Creating Content

### Blog Posts

Posts are Markdown files in `source/_posts/` with YAML frontmatter:

```yaml
---
title: Post Title
date: YYYY-MM-DD
tags:
  - tag1
  - tag2
---
```

Use `npx hexo new post "title"` to create from scaffold, or edit files directly.

### Pages

Static pages are directories under `source/` with an `index.md` file. Special layout types:
- `layout: page` - Standard page
- `layout: memos` - Interactive memo page with LeanCloud backend

## Custom Theme (yang-design)

Theme is a custom EJS-based theme located in `themes/yang-design/`. Configuration is in `themes/yang-design/_config.yml`:

- **Menus**: Home, Archives, Memos, About
- **Social Links**: GitHub and Email
- **Profile**: Site name, subtitle, motto

Theme templates use Hexo's EJS syntax with access to `page`, `site`, and other Hexo objects. See `layout/layout.ejs` for the main structure.

## Memos Feature

The `/memos/` page is an interactive memo board with:

- **Frontend**: `source/memos/index.md` with `layout: memos`
- **Backend**: LeanCloud database (`shuoshuo` table)
- **Admin**: Password verification system with MD5 hashing
- **Security**: Role-based ACL, XSS protection

Theme template: `themes/yang-design/layout/memos.ejs`

## Configuration Files

- `_config.yml`: Main Hexo config (site title, URL, theme selection, deployment)
- `themes/yang-design/_config.yml`: Theme-specific config (menus, social links, profile)
- Permalink format: `:year/:month/:day/:title/`
- Posts per page: 10
- Language: `zh-CN` (Chinese)
- Syntax highlighting: highlight.js (configured in `_config.yml`)

## Troubleshooting

### Site not updating after push:
1. Check GitHub Actions run logs in the repository
2. Confirm push was to `source` branch (not `main`)
3. Look for errors in Actions workflow

### Local server issues:
```bash
npm run clean && npm run server
```

### Dependency issues:
```bash
rm -rf node_modules && npm install
```

## Maintenance

See `维护手册.md` (Chinese) for comprehensive maintenance guide including:
- Daily workflow procedures
- Troubleshooting steps
- GitHub Actions details
- Important reminders about branch management

## Git Workflow

Always work on the `source` branch:

```bash
git status
git add .
git commit -m "descriptive message"
git push origin source
```

If there are conflicts:
```bash
git pull origin source
# resolve conflicts
git add .
git commit -m "resolve merge conflicts"
git push origin source
```
